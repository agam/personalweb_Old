<!DOCTYPE html>
<html lang="en">

<!-- TODO(agam): Get rid of this header/footer duplication ! -->
<head>
    <meta charset="utf-8" />
    <title>Posterous Browsing</title>
    <meta name="description" content="Table of Contents  and browsing for Agam's Posterous">

    <link href="/static/images/favicon.ico" rel="shortcut icon" />
    <link href="/static/css/css-mini-reset.css" rel="stylesheet" type="text/css" />
    <link href='http://fonts.googleapis.com/css?family=Crafty+Girls|Droid+Sans|Calligraffitti' rel='stylesheet' type='text/css'>
    <link href="/static/css/main.css" rel="stylesheet" type="text/css" />
    <!-- Load the 'darkness' jqueryUI theme -->
    <link href="/static/css/ui-darkness/jquery.ui.all.css" rel="stylesheet" type="text/css" />

    <!-- Load jquery from Google -->
    <script src="https://www.google.com/jsapi?key=ABQIAAAAnjiQb--VssnWxB8gJJANHRT8vATYeMg6i0IPOit6GndEekLi2xQ4F_cMnVxB8nQzMgqGJOUYavreNw" type="text/javascript"></script>
    <script language="Javascript" type="text/javascript">
        google.load("jquery", "1.6");
        google.load("jqueryui", "1.8");

        var total_posts = 0;

        var api_token = 'BouCofdeoIrIfbpzqiBfroAxfhIiJjxJGeyGgckqhpvazirtlfIzBeIunGfmeyewlCJgpIBjfCvenGjgjezxzfDmrAdbCGouEhcc';

        function setup_slider(sliderid, labelid, buttonid, func) {
            $(sliderid).slider({
                value: 0,
                min: 0,
                max: Math.round(total_posts/20),
                slide: function(event, ui) {
                    $(labelid).html(" Page: " + ui.value + "   ");
                    $(buttonid).html("<a href=\"javascript:void(0)\" onclick=\"" + func + "(" + ui.value + ");\">Fetch</a>");
                },
            });
            $(sliderid).css("min-height", "15px");
            $(sliderid).css("min-width", "50px");
            $(labelid).html("Page: 0   ");
            console.log("Slider value = " + $(sliderid).slider("value"));
            $(sliderid).slider("enable");
        }

        function get_total_posts() {
            var url = 'http://localhost:8081/posterous/getcount';
            $.getJSON(url, function(data) {
                total_posts = data.count;

                // Complete initialization here, since setup depends on total_posts (the slider).
                get_beginning_posts(0);
                get_end_posts(0);

                setup_slider("#beginningpostsslider", "#beginningpostslabel",
                    "#beginningpostsfetch", "get_beginning_posts");
                setup_slider("#endpostsslider", "#endpostslabel",
                    "#endpostsfetch", "get_end_posts");
            });
        }

        function populate_posts(divid, data) {
            $(divid).html("<ul>");
            $.each(data, function(index, post) {
                    if (post) {
                        $(divid).append("<li>" + post.post_title + "  [<a href=\"" + post.post_url + "\">Open</a>]</li>");
                    }
                    });
            $(divid).append("</ul>");
            $(divid + " li").mouseover(function() {
                    $(this).animate({'height': 70}, 'slow');
                    });
            $(divid + " li").mouseout(function() {
                    $(this).animate({'height': 25}, 'slow');
            });
        }

        function get_beginning_posts(page) {
            url = 'http://localhost:8081/posterous/getposts?order=front';
            if (page > 0) {
                url = url + '&page=' + page;
            }
            $("#status").fadeIn("slow");
            $.getJSON(url,
                    function(data) {
                    populate_posts("#beginningpostslist", data);
                    });
            $("#status").fadeOut("slow");
        }

        function get_end_posts(page) {
            var url = 'http://localhost:8081/posterous/getposts?order=back';
            if (page > 0) {
                url = url + '&page=' + page;
            }
            $("#status").fadeIn("slow");
            $.getJSON(url,
                    function(data) {
                    populate_posts("#endpostslist", data);
                    });
            $("#status").fadeOut("slow");
        }

        function init_posterous() {
            $("#status").hide();

            total_posts = get_total_posts();
        }

        google.setOnLoadCallback(init_posterous);
    </script>
    <!-- custom css for this page's layout -->
    <style type="text/css">
    </style>

</head>

<body>
    <h1>A better posterous browser</h1>

    <div id="status"><img src="/static/images/loading.gif" /></div>
    <div id="postheader"> 
        <h2>Posterous content indexed from the beginning and from the end</h2>
        <p>(Each page has 20 posts, content derived from <a href="http://agambrahma.posterous.com">agambrahma.posterous.com</a>, but pages here do not correspond to pages there)
    </div>

    <div id="beginningposts">
        <p><b>Latest : </b>
        <span id="beginningpostslabel"></span><span id="beginningpostsfetch"></span>
        <div id="beginningpostsslider"></div>
        <div id="beginningpostslist"></div>
    </div>

    <div id="endposts">
        <p><b>Oldest : </b>
        <span id="endpostslabel"></span><span id="endpostsfetch"></span>
        <div id="endpostsslider"></div>
        <div id="endpostslist"></div>
    </div>

    <footer>
    <p><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/3.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License</a>.
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-16612682-3']);
        _gaq.push(['_setDomainName', 'appengine.appspot.com']);
        _gaq.push(['_setAllowHash', false]);
        _gaq.push(['_trackPageview']);

        (function() {
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
    </script>
    </footer>
</body>
</html>
